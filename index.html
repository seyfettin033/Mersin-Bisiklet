<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>TÃ¼rkiye Camii Rehberi | Pro Mod</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        :root { --primary: #14532d; --secondary: #16a34a; --bg: #f4f5f7; }
        html, body { height: 100%; margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { display: flex; flex-direction: column; background: var(--bg); }
        
        header { background: #fff; padding: 12px; text-align: center; border-bottom: 3px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        header h1 { margin: 0; font-size: 18px; color: var(--primary); }
        
        .controls { padding: 10px; background: #fff; display: flex; flex-direction: column; gap: 8px; }
        select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; -webkit-appearance: none; }

        #sayac { padding: 12px; text-align: center; font-weight: bold; font-size: 14px; transition: 0.3s; border-bottom: 1px solid #ddd; }
        .loading { color: #2563eb; background: #eff6ff; }
        .success { color: #16a34a; background: #f0fdf4; }
        
        #map { flex-grow: 1; z-index: 1; }

        /* Popup GÃ¼zelleÅŸtirme */
        .popup-box { text-align: center; min-width: 200px; padding: 5px; }
        .popup-box b { display: block; margin-bottom: 10px; color: #b91c1c; font-size: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .btn { display: block; padding: 12px; margin-top: 8px; border-radius: 8px; text-decoration: none; color: #fff; font-weight: bold; font-size: 13px; transition: 0.2s; }
        .osm { background: #166534; }
        .street { background: #ea4335; } /* Google KÄ±rmÄ±zÄ± */
        .google { background: #fde047; color: #000; }
        .btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

<header>
    <h1>ğŸ•Œ TÃ¼rkiye Camii Rehberi</h1>
    <small>Street View ve Uydu Destekli DÃ¼zenleme</small>
</header>

<div class="controls">
    <select id="il">
        <option value="">Analiz iÃ§in il seÃ§in...</option>
        <option>Adana</option><option>AdÄ±yaman</option><option>Afyonkarahisar</option><option>AÄŸrÄ±</option><option>Amasya</option><option>Ankara</option><option>Antalya</option><option>Artvin</option><option>AydÄ±n</option><option>BalÄ±kesir</option><option>Bilecik</option><option>BingÃ¶l</option><option>Bitlis</option><option>Bolu</option><option>Burdur</option><option>Bursa</option><option>Ã‡anakkale</option><option>Ã‡ankÄ±rÄ±</option><option>Ã‡orum</option><option>Denizli</option><option>DiyarbakÄ±r</option><option>Edirne</option><option>ElazÄ±ÄŸ</option><option>Erzincan</option><option>Erzurum</option><option>EskiÅŸehir</option><option>Gaziantep</option><option>Giresun</option><option>GÃ¼mÃ¼ÅŸhane</option><option>Hakkari</option><option>Hatay</option><option>Isparta</option><option>Mersin</option><option>Ä°stanbul</option><option>Ä°zmir</option><option>Kars</option><option>Kastamonu</option><option>Kayseri</option><option>KÄ±rklareli</option><option>KÄ±rÅŸehir</option><option>Kocaeli</option><option>Konya</option><option>KÃ¼tahya</option><option>Malatya</option><option>Manisa</option><option>KahramanmaraÅŸ</option><option>Mardin</option><option>MuÄŸla</option><option>MuÅŸ</option><option>NevÅŸehir</option><option>NiÄŸde</option><option>Ordu</option><option>Rize</option><option>Sakarya</option><option>Samsun</option><option>Siirt</option><option>Sinop</option><option>Sivas</option><option>TekirdaÄŸ</option><option>Tokat</option><option>Trabzon</option><option>Tunceli</option><option>ÅanlÄ±urfa</option><option>UÅŸak</option><option>Van</option><option>Yozgat</option><option>Zonguldak</option><option>Aksaray</option><option>Bayburt</option><option>Karaman</option><option>KÄ±rÄ±kkale</option><option>Batman</option><option>ÅÄ±rnak</option><option>BartÄ±n</option><option>Ardahan</option><option>IÄŸdÄ±r</option><option>Yalova</option><option>KarabÃ¼k</option><option>Kilis</option><option>Osmaniye</option><option>DÃ¼zce</option>
    </select>
</div>

<div id="sayac">LÃ¼tfen bir ÅŸehir seÃ§in.</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Katmanlar (Standart ve Uydu)
    var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OSM' });
    var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EBP, and the GIS User Community'
    });

    var map = L.map('map', {
        center: [39.0, 35.0],
        zoom: 6,
        layers: [osmLayer] // VarsayÄ±lan katman
    });

    // Katman KontrolÃ¼ (SaÄŸ Ãœst KÃ¶ÅŸe)
    var baseMaps = {
        "ğŸ—ºï¸ Standart": osmLayer,
        "ğŸ›°ï¸ Uydu GÃ¶rÃ¼nÃ¼mÃ¼": satelliteLayer
    };
    L.control.layers(baseMaps).addTo(map);

    var layerGroup = L.layerGroup().addTo(map);

    document.getElementById("il").addEventListener("change", function () {
        var il = this.value;
        var sayac = document.getElementById("sayac");
        if (!il) return;

        layerGroup.clearLayers();
        sayac.innerHTML = `âŒ› ${il} iÃ§in veriler sorgulanÄ±yor...`;
        sayac.className = "loading";

        var query = `
        [out:json][timeout:60];
        area["name"="${il}"]["admin_level"="4"]->.a;
        (
          node["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."](area.a);
          way["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."](area.a);
        );
        out center;`;

        fetch("https://overpass-api.de/api/interpreter", { method: "POST", body: query })
        .then(r => r.json())
        .then(data => {
            var adet = data.elements.length;
            var points = [];

            if (adet === 0) {
                sayac.innerHTML = `ğŸ‰ ${il} ilinde isimsiz cami kalmamÄ±ÅŸ!`;
                sayac.className = "success";
                return;
            }

            sayac.innerHTML = `ğŸ“ ${il}: ${adet} isimsiz cami dÃ¼zenleme bekliyor.`;
            sayac.className = "success";

            data.elements.forEach(el => {
                var lat = el.lat || el.center.lat;
                var lon = el.lon || el.center.lon;
                points.push([lat, lon]);

                var type = el.type;
                var id = el.id;

                // Linkler
                var osmEditUrl = `https://www.openstreetmap.org/edit?editor=id&${type}=${id}#map=19/${lat}/${lon}`;
                var streetViewUrl = `https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${lat},${lon}`;
                var googleSearchUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;

                var popupHtml = `
                    <div class="popup-box">
                        <b>ğŸ“ Ä°simsiz Cami</b>
                        <a href="${osmEditUrl}" target="_blank" class="btn osm">âœï¸ OSM'de DoÄŸrudan DÃ¼zenle</a>
                        <a href="${streetViewUrl}" target="_blank" class="btn street">ğŸ“¸ Sokak GÃ¶rÃ¼nÃ¼mÃ¼ (Street View)</a>
                        <a href="${googleSearchUrl}" target="_blank" class="btn google">ğŸ” Google Haritalarda Ara</a>
                    </div>`;

                L.circleMarker([lat, lon], {
                    radius: 7,
                    color: "#14532d",
                    fillColor: "#22c55e",
                    fillOpacity: 0.85,
                    weight: 2
                })
                .addTo(layerGroup)
                .bindPopup(popupHtml);
            });

            if (points.length > 0) map.fitBounds(points, { padding: [40, 40] });
        })
        .catch(err => {
            sayac.innerHTML = "âŒ Hata: Veri Ã§ekilemedi.";
            sayac.className = "error";
        });
    });
</script>

</body>
</html>
