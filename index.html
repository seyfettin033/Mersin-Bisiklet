<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>TÜRKİYE Camileri</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
header{background:#e30a17;color:#fff;display:flex;align-items:center;gap:12px;padding:12px}
.flag{width:48px;height:32px;background:url("https://flagcdn.com/tr.svg") no-repeat center/contain}
h1{font-size:18px;margin:0}
#namaz,#ayet{background:#fff;padding:10px;text-align:center;font-size:13px}
#ayet{background:#fff3cd}
#map{height:50vh}
#panel{background:#fff;padding:10px;max-height:35vh;overflow:auto}
input,button{padding:6px;margin:3px}
button{cursor:pointer}
ul{list-style:none;padding:0;margin:0}
li{border-bottom:1px solid #eee;padding:6px;display:flex;justify-content:space-between;align-items:center}
.yol{background:#007bff;color:#fff;padding:4px 8px;border-radius:4px;text-decoration:none;font-size:12px}
footer{text-align:center;font-size:12px;color:#555;padding:12px}
</style>
</head>

<body>

<header>
<div class="flag"></div>
<h1>TÜRKİYE Camileri</h1>
</header>

<div id="namaz">Namaz vakitleri yükleniyor...</div>
<div id="ayet">Ayet yükleniyor...</div>

<div style="padding:8px;background:#fff">
<input id="il" placeholder="İl">
<input id="ilce" placeholder="İlçe">
<button onclick="ilIlceAra()">Ara</button>
<button onclick="pdfIndir()">PDF</button>
<button onclick="excelIndir()">Excel</button>
</div>

<div id="map"></div>

<div id="panel">
<div><b id="durum">Hazır</b> | <b id="sayac">0 Cami</b></div>
<ul id="liste"></ul>
</div>

<footer>
Bu veri ticari amaçla kullanılamaz.<br>
Seyfettin Gündoğdu tarafından hazırlanmıştır.
</footer>

<script>
let map=L.map("map").setView([39,35],6);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
let markers=L.layerGroup().addTo(map);

let userLat=0,userLon=0;
let tumCamiler=[];
let secilenIl="",secilenIlce="",secilenMahalle="";

/* KONUM */
navigator.geolocation.getCurrentPosition(p=>{
userLat=p.coords.latitude;
userLon=p.coords.longitude;
map.setView([userLat,userLon],14);
L.circle([userLat,userLon],{radius:200,color:"blue"}).addTo(map);
namaz(userLat,userLon);
camileriYukle(userLat,userLon);
});

/* NAMAZ */
function namaz(lat,lon){
fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=13`)
.then(r=>r.json()).then(d=>{
let t=d.data.timings;
document.getElementById("namaz").innerHTML=
`İmsak ${t.Fajr} | Güneş ${t.Sunrise} | Öğle ${t.Dhuhr} | İkindi ${t.Asr} | Akşam ${t.Maghrib} | Yatsı ${t.Isha}`;
});
}

/* AYET */
fetch("https://api.alquran.cloud/v1/ayah/255/tr.diyanet")
.then(r=>r.json()).then(d=>{
document.getElementById("ayet").innerText=d.data.text;
});

/* İL İLÇE */
function ilIlceAra(){
secilenIl=il.value;
secilenIlce=ilce.value;
fetch(`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&q=${secilenIl} ${secilenIlce}`)
.then(r=>r.json()).then(d=>{
if(!d[0]) return alert("Bulunamadı");
userLat=parseFloat(d[0].lat);
userLon=parseFloat(d[0].lon);
secilenMahalle=d[0].address?.suburb||"";
map.setView([userLat,userLon],14);
camileriYukle(userLat,userLon);
});
}

/* CAMİLER */
function mesafe(a,b,c,d){
let R=6371;
let x=(c-a)*Math.PI/180;
let y=(d-b)*Math.PI/180;
let h=Math.sin(x/2)**2+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(y/2)**2;
return 2*R*Math.asin(Math.sqrt(h));
}

function camileriYukle(lat,lon){
markers.clearLayers();
tumCamiler=[];
document.getElementById("durum").innerText="Aranıyor...";

let q=`[out:json];
node["amenity"="place_of_worship"]["religion"="muslim"](around:3000,${lat},${lon});
out;`;

fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:"data="+encodeURIComponent(q)})
.then(r=>r.json()).then(d=>{
d.elements.forEach(e=>{
let ad=e.tags?.name||"İsimsiz Cami";
let la=e.lat,lo=e.lon;
let m=mesafe(lat,lon,la,lo);
tumCamiler.push({ad,la,lo,mes:m});
L.marker([la,lo]).addTo(markers)
.bindPopup(`${ad}<br><a target=_blank href="https://www.google.com/maps/dir/?destination=${la},${lo}">Yol Tarifi</a>`);
});
tumCamiler.sort((a,b)=>a.mes-b.mes);
listele();
});
}

function listele(){
let html="";
tumCamiler.forEach((c,i)=>{
html+=`<li>${i+1}. ${c.ad} (${c.mes.toFixed(2)} km)
<a class="yol" target="_blank"
href="https://www.google.com/maps/dir/?destination=${c.la},${c.lo}">Git</a></li>`;
});
liste.innerHTML=html;
sayac.innerText=tumCamiler.length+" Cami";
durum.innerText="Güncel";
}

/* PDF */
function pdfIndir(){
const {jsPDF}=window.jspdf;
let pdf=new jsPDF();
pdf.setFontSize(16);
pdf.text("TÜRKİYE Camileri",10,15);
pdf.setFontSize(10);
pdf.text(`İl: ${secilenIl||"-"} İlçe: ${secilenIlce||"-"} Mahalle: ${secilenMahalle||"-"}`,10,23);
pdf.text("Bu veri ticari amaçla kullanılamaz.",10,29);
let y=40;
tumCamiler.forEach((c,i)=>{
pdf.text(`${i+1}. ${c.ad} - ${c.mes.toFixed(2)} km`,10,y);
y+=7;
if(y>280){pdf.addPage();y=20;}
});
pdf.save("turkiye_camileri_verisi.pdf");
}

/* EXCEL */
function excelIndir(){
let veri=[
{"":"TÜRKİYE Camileri"},
{"":`İl: ${secilenIl||"-"} | İlçe: ${secilenIlce||"-"} | Mahalle: ${secilenMahalle||"-"}`},
{"":"Bu veri ticari amaçla kullanılamaz."},
{},
...tumCamiler.map((c,i)=>({
"Sıra":i+1,
"Cami Adı":c.ad,
"Mesafe (km)":c.mes.toFixed(2),
"Enlem":c.la,
"Boylam":c.lo
}))
];
let ws=XLSX.utils.json_to_sheet(veri);
let wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Türkiye Camileri");
XLSX.writeFile(wb,"turkiye_camileri_verisi.xlsx");
}
</script>

</body>
</html>