<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>TÃ¼rkiye Camii Rehberi | DoÄŸrudan DÃ¼zenleme</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        :root { --primary: #14532d; --secondary: #16a34a; --bg: #f4f5f7; }
        html, body { height: 100%; margin: 0; font-family: sans-serif; }
        body { display: flex; flex-direction: column; background: var(--bg); }
        header { background: #fff; padding: 15px; text-align: center; border-bottom: 3px solid var(--primary); }
        header h1 { margin: 0; font-size: 18px; color: var(--primary); }
        .controls { padding: 10px; background: #fff; border-bottom: 1px solid #ddd; }
        select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
        #sayac { padding: 10px; text-align: center; font-weight: bold; background: #fff; border-bottom: 1px solid #ddd; transition: 0.3s; }
        .loading { color: #2563eb; background: #eff6ff; }
        .success { color: #16a34a; background: #f0fdf4; }
        #map { flex-grow: 1; }
        .popup-box { text-align: center; min-width: 160px; }
        .btn { display: block; padding: 10px; margin-top: 5px; border-radius: 5px; text-decoration: none; color: #fff; font-weight: bold; font-size: 12px; }
        .osm { background: #166534; }
        .google { background: #fde047; color: #000; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ•Œ TÃ¼rkiye Camii Rehberi</h1>
    <small>Objeyi Otomatik SeÃ§en EditÃ¶r Modu</small>
</header>

<div class="controls">
    <select id="il">
        <option value="">Ä°l seÃ§in...</option>
        <option>Adana</option><option>Ankara</option><option>Ä°stanbul</option><option>Ä°zmir</option>
        <option>Bursa</option><option>Konya</option><option>Antalya</option><option>Mersin</option>
    </select>
</div>

<div id="sayac">LÃ¼tfen bir ÅŸehir seÃ§in.</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    var map = L.map('map').setView([39.0, 35.0], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    var layerGroup = L.layerGroup().addTo(map);

    document.getElementById("il").addEventListener("change", function () {
        var il = this.value;
        var sayac = document.getElementById("sayac");
        if (!il) return;

        layerGroup.clearLayers();
        sayac.innerHTML = "âŒ› Veriler getiriliyor...";
        sayac.className = "loading";

        var query = `
        [out:json][timeout:50];
        area["name"="${il}"]["admin_level"="4"]->.a;
        (
          node["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."](area.a);
          way["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."](area.a);
        );
        out center;`;

        fetch("https://overpass-api.de/api/interpreter", { method: "POST", body: query })
        .then(r => r.json())
        .then(data => {
            var adet = data.elements.length;
            var points = [];

            if (adet === 0) {
                sayac.innerHTML = "ğŸ‰ Bu ilde isimsiz cami kalmamÄ±ÅŸ!";
                sayac.className = "success";
                return;
            }

            sayac.innerHTML = `${il}: ${adet} isimsiz cami bulundu.`;
            sayac.className = "success";

            data.elements.forEach(el => {
                var lat = el.lat || el.center.lat;
                var lon = el.lon || el.center.lon;
                points.push([lat, lon]);

                // KRÄ°TÄ°K NOKTA: type/id parametresi objeyi otomatik seÃ§er
                var type = el.type; // "node" veya "way"
                var id = el.id;
                var osmEditUrl = `https://www.openstreetmap.org/edit?editor=id&${type}=${id}#map=19/${lat}/${lon}`;
                var googleUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;

                var popupHtml = `
                    <div class="popup-box">
                        <b>ğŸ“ Ä°simsiz ${type === 'way' ? 'Alan' : 'Nokta'}</b>
                        <a href="${osmEditUrl}" target="_blank" class="btn osm">âœï¸ DoÄŸrudan SeÃ§ ve DÃ¼zenle</a>
                        <a href="${googleUrl}" target="_blank" class="btn google">ğŸ” Google'da Bak</a>
                    </div>`;

                L.circleMarker([lat, lon], { radius: 7, color: "#14532d", fillColor: "#22c55e", fillOpacity: 0.8 })
                    .addTo(layerGroup)
                    .bindPopup(popupHtml);
            });

            if (points.length > 0) map.fitBounds(points, { padding: [40, 40] });
        });
    });
</script>

</body>
</html>
