<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cami Rehberi - Kesin √á√∂z√ºm</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: sans-serif; background: #fff; }
        #map { height: 40vh; width: 100%; position: relative; z-index: 1; }
        #panel { height: 60vh; width: 100%; overflow-y: auto; background: white; padding: 10px; box-sizing: border-box; }
        #scan-btn { 
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%); 
            z-index: 9999; background: #e30a17; color: white; border: 2px solid white; 
            padding: 15px 30px; border-radius: 50px; font-weight: bold; font-size: 16px;
        }
        .card { border: 2px solid #000; padding: 15px; margin-bottom: 10px; border-radius: 10px; background: #f0f0f0; display: block !important; visibility: visible !important; }
        .status { color: #e30a17; font-weight: bold; text-align: center; margin-bottom: 10px; border: 1px solid #e30a17; padding: 10px; }
        .btn-link { display: inline-block; background: #007bff; color: white; padding: 10px; margin-top: 5px; text-decoration: none; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

<button id="scan-btn" onclick="tara()">üöÄ 49 NOKTAYI ZORLA Lƒ∞STELE</button>

<div id="map"></div>

<div id="panel">
    <div id="status" class="status">Cihaz hazƒ±r. Butona basƒ±n.</div>
    <div id="liste"></div>
</div>

<script>
    var map = L.map('map').setView([37.871, 32.491], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    var markerLayer = L.featureGroup().addTo(map);

    window.processOSM = function(data) {
        var status = document.getElementById('status');
        var liste = document.getElementById('liste');
        var htmlIcerik = ""; 
        
        markerLayer.clearLayers();

        if (data && data.elements) {
            data.elements.forEach(function(el) {
                var lat = el.lat || (el.center ? el.center.lat : null);
                var lon = el.lon || (el.center ? el.center.lng : null);
                
                if (lat && lon) {
                    var ad = (el.tags && el.tags.name) ? el.tags.name : "ƒ∞simsiz Cami";
                    
                    // 1. Haritaya basit bir kƒ±rmƒ±zƒ± daire ekle
                    L.circleMarker([lat, lon], { radius: 10, color: 'red' }).addTo(markerLayer);
                    
                    // 2. Tablo yerine basit metin bloklarƒ± olu≈ütur
                    htmlIcerik += '<div class="card">' +
                        '<strong>' + ad + '</strong><br>' +
                        '<a class="btn-link" href="https://www.google.com/maps?q=' + lat + ',' + lon + '" target="_blank">üìç GOOGLE HARƒ∞TADA G√ñR</a>' +
                    '</div>';
                }
            });
            
            // Veriyi tek bir seferde ekrana bas (Bu y√∂ntem asla hata vermez)
            liste.innerHTML = htmlIcerik;
            status.innerText = "‚úÖ " + data.elements.length + " nokta a≈üaƒüƒ±da listelendi!";
            map.fitBounds(markerLayer.getBounds());
        }
    };

    function tara() {
        var b = map.getBounds();
        var bbox = b.getSouth() + "," + b.getWest() + "," + b.getNorth() + "," + b.getEast();
        document.getElementById('status').innerText = "‚è≥ Veri d√∂k√ºl√ºyor...";

        var q = '[out:json][timeout:25];(node["amenity"="place_of_worship"]["religion"="muslim"](' + bbox + ');way["amenity"="place_of_worship"]["religion"="muslim"](' + bbox + '););out center;';
        var s = document.createElement('script');
        s.src = "https://overpass-api.de/api/interpreter?data=" + encodeURIComponent(q) + "&jsonp=processOSM";
        document.body.appendChild(s);
    }
</script>
</body>
</html>
