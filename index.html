<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>T√ºrkiye Camii Rehberi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body {
    margin: 0;
    font-family: system-ui, -apple-system;
    background: #f6f7f8;
}
header {
    background: #fff;
    padding: 10px;
    border-bottom: 1px solid #ddd;
}
.title {
    text-align: center;
    font-weight: 600;
    color: #1f7a3a;
    margin-bottom: 8px;
}
.filters {
    display: flex;
    gap: 8px;
}
select {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
}
#map {
    height: calc(100vh - 95px);
}
.btn {
    display: block;
    padding: 6px;
    margin-top: 6px;
    text-align: center;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
}
.osm { background:#2e7d32;color:#fff; }
.google { background:#fbbc04;color:#000; }
</style>
</head>

<body>

<header>
    <div class="title">üïå T√ºrkiye Camii Rehberi</div>
    <div class="filters">
        <select id="il"></select>
        <select id="ilce"></select>
    </div>
</header>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// === HARƒ∞TA ===
var map = L.map('map').setView([39,35], 6);
var markers = [];

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

// === ƒ∞L / ƒ∞L√áE + BBOX ===
const data = {
    "Konya": {
        bbox:[37.2,31.1,38.3,33.5],
        ilceler:{
            "Sel√ßuklu":[37.83,32.44,37.93,32.60],
            "Meram":[37.70,32.35,37.85,32.55],
            "Karatay":[37.75,32.55,37.90,32.75]
        }
    },
    "Ankara":{
        bbox:[39.5,32.4,40.2,33.1],
        ilceler:{
            "√áankaya":[39.85,32.75,39.95,32.95],
            "Ke√ßi√∂ren":[39.95,32.80,40.05,32.95]
        }
    }
};

// === DROPDOWN DOLDUR ===
const ilSelect = document.getElementById("il");
const ilceSelect = document.getElementById("ilce");

ilSelect.innerHTML = `<option value="">ƒ∞l Se√ßiniz</option>`;
for(let il in data){
    ilSelect.innerHTML += `<option value="${il}">${il}</option>`;
}

ilSelect.onchange = ()=>{
    ilceSelect.innerHTML = `<option value="">ƒ∞l√ße Se√ßiniz</option>`;
    let il = ilSelect.value;
    if(!il) return;

    for(let ilce in data[il].ilceler){
        ilceSelect.innerHTML += `<option value="${ilce}">${ilce}</option>`;
    }
    loadCamiler(data[il].bbox);
};

ilceSelect.onchange = ()=>{
    let il = ilSelect.value;
    let ilce = ilceSelect.value;
    if(il && ilce){
        loadCamiler(data[il].ilceler[ilce]);
    }
};

// === CAMƒ∞LERƒ∞ Y√úKLE ===
function loadCamiler(bbox){
    markers.forEach(m=>map.removeLayer(m));
    markers = [];

    let query = `
    [out:json][timeout:40];
    (
      node["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."](${bbox.join(",")});
      way["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."](${bbox.join(",")});
    );
    out center;
    `;

    fetch("https://overpass-api.de/api/interpreter",{
        method:"POST",
        body:query
    })
    .then(r=>r.json())
    .then(d=>{
        if(d.elements.length){
            map.setView([
                d.elements[0].lat || d.elements[0].center.lat,
                d.elements[0].lon || d.elements[0].center.lon
            ],12);
        }

        d.elements.forEach(el=>{
            let lat = el.lat || el.center.lat;
            let lon = el.lon || el.center.lon;

            let osm = `https://www.openstreetmap.org/edit?editor=id#map=19/${lat}/${lon}`;
            let google = `https://www.google.com/maps/search/cami/@${lat},${lon},19z`;

            let m = L.circleMarker([lat,lon],{
                radius:6,color:"#1f7a3a",fillOpacity:0.9
            }).addTo(map)
            .bindPopup(`
                <b>‚ùó ƒ∞simsiz Cami</b>
                <a class="btn osm" href="${osm}" target="_blank">OSM‚Äôde D√ºzenle</a>
                <a class="btn google" href="${google}" target="_blank">Google Kontrol</a>
            `);
            markers.push(m);
        });
    });
}
</script>

</body>
</html>