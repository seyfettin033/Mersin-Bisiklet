<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TÜRKİYE Camileri</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; font-family: Arial, sans-serif; background:#f2f2f2; }

/* ÜST BAR */
header {
  background:#e30a17;
  color:white;
  padding:10px;
  display:flex;
  align-items:center;
  gap:10px;
}
header img {
  height:36px;
  background:white;
  padding:3px;
  border-radius:4px;
}
header h1 {
  font-size:20px;
  margin:0;
}

/* BİLGİ ALANLARI */
#namaz, #ayet {
  background:white;
  padding:10px;
  text-align:center;
  font-size:14px;
}

/* ARAMA */
#arama {
  background:white;
  padding:10px;
  text-align:center;
}
#arama input {
  padding:6px;
  width:65%;
}
#arama button {
  padding:6px 10px;
  background:#e30a17;
  color:white;
  border:none;
  border-radius:4px;
}

/* HARİTA */
#map {
  height:55vh;
}

/* LİSTE */
#panel {
  background:white;
  padding:10px;
}
#sonuclar li {
  border-bottom:1px solid #ddd;
  padding:6px;
  font-size:14px;
}

/* FOOTER */
footer {
  background:#eee;
  padding:10px;
  text-align:center;
  font-size:13px;
  color:#555;
}
</style>
</head>

<body>

<header>
  <!-- LOGOLAR (PNG – GARANTİ) -->
  <img src="https://upload.wikimedia.org/wikipedia/commons/b/b4/Flag_of_Turkey.svg">
  <h1>TÜRKİYE Camileri</h1>
</header>

<div id="namaz">Namaz saatleri yükleniyor…</div>
<div id="ayet">Günün ayeti yükleniyor…</div>

<div id="arama">
  <input id="aramaInput" placeholder="Cami adı ara">
  <button onclick="filtrele()">Ara</button>
</div>

<div id="map"></div>

<div id="panel">
  <b id="sayac">0 Cami</b>
  <ul id="sonuclar"></ul>
</div>

<footer>
  Bu sayfa <b>Seyfettin Gündoğdu</b> tarafından hazırlanmıştır.
</footer>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let tumCamiler = [];
let userLat = 0, userLon = 0;

/* HARİTA */
const map = L.map("map").setView([39, 35], 6);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
const markerLayer = L.layerGroup().addTo(map);

/* KONUM */
navigator.geolocation.getCurrentPosition(pos => {
  userLat = pos.coords.latitude;
  userLon = pos.coords.longitude;

  map.setView([userLat, userLon], 14);
  L.marker([userLat, userLon]).addTo(map).bindPopup("Konumunuz").openPopup();

  namazSaatleri(userLat, userLon);
  camileriGetir(userLat, userLon);
});

/* NAMAZ */
function namazSaatleri(lat, lon) {
  fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=13`)
    .then(r => r.json())
    .then(d => {
      const t = d.data.timings;
      document.getElementById("namaz").innerText =
        `İmsak ${t.Fajr} | Öğle ${t.Dhuhr} | İkindi ${t.Asr} | Akşam ${t.Maghrib} | Yatsı ${t.Isha}`;
    });
}

/* AYET */
fetch("https://api.alquran.cloud/v1/ayah/255/tr.diyanet")
  .then(r => r.json())
  .then(d => {
    document.getElementById("ayet").innerText = `"${d.data.text}"`;
  });

/* MESAFE */
function kmHesapla(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(dLat/2)**2 +
    Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) *
    Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

/* CAMİLER */
function camileriGetir(lat, lon) {
  fetch("https://overpass-api.de/api/interpreter", {
    method: "POST",
    body: "data=" + encodeURIComponent(`
[out:json][timeout:25];
(
  node["amenity"="place_of_worship"](around:3000,${lat},${lon});
  way["amenity"="place_of_worship"](around:3000,${lat},${lon});
);
out center;
`)
  })
  .then(r => r.json())
  .then(d => {
    tumCamiler = [];
    markerLayer.clearLayers();

    d.elements.forEach(e => {
      const ad = e.tags?.name || "";
      const isim = ad.toLowerCase();

      if (!isim.includes("cami") && !isim.includes("mescit")) return;
      if (isim.includes("kilise") || isim.includes("sinagog")) return;

      const la = e.lat || e.center?.lat;
      const lo = e.lon || e.center?.lon;
      if (!la || !lo) return;

      const km = kmHesapla(userLat, userLon, la, lo);
      tumCamiler.push({ ad, la, lo, km });
    });

    tumCamiler.sort((a,b) => a.km - b.km);
    listele(tumCamiler);
  });
}

/* LİSTELE */
function listele(liste) {
  markerLayer.clearLayers();
  let html = "";

  liste.forEach(c => {
    L.marker([c.la, c.lo]).addTo(markerLayer)
      .bindPopup(`<b>${c.ad}</b><br>${c.km.toFixed(2)} km<br>
      <a target="_blank" href="https://www.google.com/maps/dir/?api=1&destination=${c.la},${c.lo}">
      Yol Tarifi</a>`);

    html += `<li>${c.ad} – ${c.km.toFixed(2)} km</li>`;
  });

  document.getElementById("sonuclar").innerHTML = html;
  document.getElementById("sayac").innerText = liste.length + " Cami";
}

/* ARAMA */
function filtrele() {
  const f = document.getElementById("aramaInput").value.toLowerCase();
  listele(tumCamiler.filter(c => c.ad.toLowerCase().includes(f)));
}
</script>

</body>
</html>