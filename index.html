<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cami Rehberi Kesin Ã‡Ã¶zÃ¼m</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; background: #fff; }
        
        header { background: #e30a17; color: white; padding: 15px; text-align: center; font-weight: bold; height: 50px; z-index: 2000; }
        
        /* HaritanÄ±n GÃ¶rÃ¼nmesi Ä°Ã§in Kritik Alan */
        #map-container { position: relative; flex: 1; min-height: 300px; width: 100%; z-index: 1; }
        #map { height: 100% !important; width: 100% !important; background: #f0f0f0; }

        #panel { height: 40vh; overflow-y: auto; background: #fff; border-top: 5px solid #d4af37; padding: 10px; z-index: 1000; }
        
        .tara-btn { 
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1001; background: #e30a17; color: white; border: 2px solid white;
            padding: 12px 25px; border-radius: 30px; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .item { border-bottom: 1px solid #eee; padding: 15px 0; }
        .btn-git { display: block; background: #007bff; color: white; text-align: center; padding: 12px; border-radius: 5px; text-decoration: none; margin-top: 10px; font-weight: bold; }
        .status { font-size: 13px; color: #e30a17; margin-bottom: 10px; text-align: center; }
    </style>
</head>
<body>

<header>CAMÄ° REHBERÄ° V3.0</header>

<div id="map-container">
    <button class="tara-btn" onclick="tara()">ğŸ“ BÃ–LGEYÄ° TARA</button>
    <div id="map"></div>
</div>

<div id="panel">
    <div id="status" class="status">Harita yÃ¼kleniyor...</div>
    <div id="liste"></div>
</div>

<script>
    var map, markers;

    // HaritayÄ± zorla baÅŸlat
    function haritayiKur() {
        try {
            map = L.map('map', { zoomControl: false }).setView([37.87, 32.48], 13); // Konya Meram BaÅŸlangÄ±Ã§
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            markers = L.layerGroup().addTo(map);
            document.getElementById('status').innerText = "Harita hazÄ±r. Tara butona basÄ±n.";
        } catch (e) {
            document.getElementById('status').innerText = "Hata: Harita kÃ¼tÃ¼phanesi yÃ¼klenemedi!";
        }
    }

    async function tara() {
        var c = map.getCenter();
        document.getElementById('status').innerText = "â³ Veriler sunucudan Ã§ekiliyor...";
        
        // Sunucuya gÃ¶nderilen en saf sorgu
        var q = '[out:json][timeout:25];node["amenity"="place_of_worship"]["religion"="muslim"](around:4000,'+c.lat+','+c.lng+');out;';
        var url = "https://overpass-api.de/api/interpreter?data=" + encodeURIComponent(q);

        try {
            const res = await fetch(url);
            const data = await res.json();
            
            markers.clearLayers();
            var html = "";
            
            if(!data.elements || data.elements.length === 0) {
                document.getElementById('status').innerText = "âŒ Bu bÃ¶lgede sonuÃ§ bulunamadÄ±.";
                return;
            }

            data.elements.forEach(el => {
                var isim = el.tags.name || "Ä°simsiz Cami / Mescit";
                L.marker([el.lat, el.lon]).addTo(markers).bindPopup(isim);

                html += '<div class="item"><b>' + isim + '</b>' +
                        '<a href="https://www.google.com/maps/dir/?api=1&destination=' + el.lat + ',' + el.lon + '" target="_blank" class="btn-git">ğŸ“ YOL TARÄ°FÄ° AL</a></div>';
            });

            document.getElementById('liste').innerHTML = html;
            document.getElementById('status').innerText = "âœ… " + data.elements.length + " nokta listelendi.";

        } catch (err) {
            document.getElementById('status').innerText = "âš ï¸ BaÄŸlantÄ± hatasÄ±! LÃ¼tfen tekrar deneyin.";
        }
    }

    // Pencere yÃ¼klendiÄŸinde haritayÄ± aÃ§
    window.onload = haritayiKur;
</script>
</body>
</html>
