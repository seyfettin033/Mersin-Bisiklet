function verileriYukle(lat, lon) {
    const durumElemani = document.getElementById('durum');
    durumElemani.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Yükleniyor...';
    
    // Sorguyu sadeleştirdik ve sadece 'mosque' odaklı hale getirdik
    var query = `[out:json][timeout:25];
    (
      node["amenity"="place_of_worship"]["religion"="muslim"](around:2000,${lat},${lon});
      way["amenity"="place_of_worship"]["religion"="muslim"](around:2000,${lat},${lon});
      relation["amenity"="place_of_worship"]["religion"="muslim"](around:2000,${lat},${lon});
    );
    out center;`;

    // API URL'sinin HTTPS olduğundan emin olun
    fetch("https://overpass-api.de/api/interpreter", {
        method: "POST", // GET yerine POST bazen daha stabildir
        body: "data=" + encodeURIComponent(query)
    })
    .then(res => {
        if (!res.ok) throw new Error("Sunucu hatası: " + res.status);
        return res.json();
    })
    .then(data => {
        markers.clearLayers();
        mevcutVeriler = [];
        let html = "";
        
        if (!data.elements || data.elements.length === 0) {
            durumElemani.innerText = "Bu bölgede kayıt bulunamadı.";
            return;
        }

        data.elements.forEach(el => {
            let cLat = el.lat || (el.center && el.center.lat);
            let cLon = el.lon || (el.center && el.center.lng);
            if (!cLat || !cLon) return;

            let ad = el.tags.name || "İsimsiz İbadethane";
            
            mevcutVeriler.push({ "Cami Adı": ad, "Enlem": cLat, "Boylam": cLon });

            L.marker([cLat, cLon]).addTo(markers).bindPopup(ad);

            html += `
                <div class="cami-kart">
                    <div>
                        <div class="isim">${ad}</div>
                        <div style="font-size:0.75em; color:#999;">${el.tags["addr:street"] || "Adres bilgisi yok"}</div>
                    </div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=${cLat},${cLon}" target="_blank" class="nav-btn">Yol Tarifi</a>
                </div>`;
        });
        
        document.getElementById('sonuclar').innerHTML = html;
        durumElemani.innerText = "Güncel";
        document.getElementById('sayac').innerText = data.elements.length + " Cami";
    })
    .catch(err => {
        console.error("Hata detayı:", err);
        durumElemani.innerText = "Hata: Sunucuya erişilemedi.";
    });
}
