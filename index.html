<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TÃœRKÄ°YE Camileri | Rehber</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        body { margin:0; font-family: 'Segoe UI', Arial, sans-serif; background:#f4f4f4; overflow-x: hidden; }
        header { display:flex; align-items:center; gap:15px; padding:15px; background:#e30a17; color:white; border-bottom: 4px solid #c10914; }
        .flag { width:50px; height:33px; background: url('https://flagcdn.com/tr.svg') no-repeat center; background-size: contain; }
        header h1 { font-size:20px; margin:0; text-transform: uppercase; letter-spacing: 1px; }
        #namaz { background:white; padding:12px; text-align:center; font-size:13px; border-bottom: 1px solid #ddd; display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; }
        #namaz span { background: #f8f9fa; padding: 5px 10px; border-radius: 5px; border: 1px solid #eee; font-weight: bold; color: #333; }
        #ayet { background:#fff3cd; padding:15px; font-style:italic; text-align:center; font-size:14px; line-height: 1.5; color: #856404; border-bottom: 1px solid #ffeeba; }
        #map { height:50vh; width: 100%; }
        #panel { padding:15px; background:white; max-height: 30vh; overflow-y: auto; }
        .durum-cubugu { margin-bottom: 10px; font-size: 14px; color: #666; border-bottom: 2px solid #f4f4f4; padding-bottom: 5px; }
        #sonuclar { list-style: none; padding: 0; margin: 0; }
        #sonuclar li { padding:10px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .yol-btn { background: #007bff; color: white; text-decoration: none; padding: 5px 10px; border-radius: 4px; font-size: 12px; }
        footer { text-align:center; padding:15px; font-size:12px; color:#777; background:#eee; }
    </style>
</head>
<body>

<header>
    <div class="flag"></div>
    <h1>TÃœRKÄ°YE Camileri</h1>
</header>

<div id="namaz">Vakitler yÃ¼kleniyor...</div>
<div id="ayet">Ayet-i Kerime yÃ¼kleniyor...</div>

<div id="map"></div>

<div id="panel">
    <div class="durum-cubugu">
        <i class="fa-solid fa-location-dot"></i> <span id="durum">Konum bekleniyor...</span> | 
        <i class="fa-solid fa-mosque"></i> <span id="sayac">0 Cami</span>
    </div>
    <ul id="sonuclar"></ul>
</div>

<footer>
    Â© 2024 - <b>Seyfettin GÃ¼ndoÄŸdu</b> | Veriler: OpenStreetMap & Aladhan API
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([39, 35], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OSM'
}).addTo(map);
const markers = L.layerGroup().addTo(map);

// KONUM ALMA
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        map.setView([lat, lon], 14);
        L.circle([lat, lon], {radius: 200, color: 'blue'}).addTo(map).bindPopup("BuradasÄ±nÄ±z");

        namazSaatleri(lat, lon);
        camileriYukle(lat, lon);
    }, () => {
        document.getElementById("durum").innerText = "Konum izni reddedildi.";
    });
}

// NAMAZ VAKÄ°TLERÄ°
function namazSaatleri(lat, lon) {
    fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=13`)
    .then(r => r.json())
    .then(d => {
        const t = d.data.timings;
        document.getElementById("namaz").innerHTML = `
            <span>Ä°msak <b>${t.Fajr}</b></span>
            <span>GÃ¼neÅŸ <b>${t.Sunrise}</b></span>
            <span>Ã–ÄŸle <b>${t.Dhuhr}</b></span>
            <span>Ä°kindi <b>${t.Asr}</b></span>
            <span>AkÅŸam <b>${t.Maghrib}</b></span>
            <span>YatsÄ± <b>${t.Isha}</b></span>
        `;
    }).catch(() => document.getElementById("namaz").innerText = "Vakitler alÄ±namadÄ±.");
}

// AYET Ã‡EKME (Diyanet Meali)
fetch("https://api.alquran.cloud/v1/ayah/262/tr.diyanet")
.then(r=>r.json())
.then(d=>{
    document.getElementById("ayet").innerHTML = `<i class="fa-solid fa-quote-left"></i> ${d.data.text} <small>(${d.data.surah.englishName} / ${d.data.numberInSurah})</small>`;
});

// CAMÄ°LERÄ° YÃœKLE
function camileriYukle(lat, lon) {
    document.getElementById("durum").innerText = "Camiler aranÄ±yor...";
    
    // Sadece MÃ¼slÃ¼man ibadethanelerini filtreleyen temiz sorgu
    const q = `[out:json][timeout:25];
    (
      node["amenity"="place_of_worship"]["religion"="muslim"](around:3000,${lat},${lon});
      way["amenity"="place_of_worship"]["religion"="muslim"](around:3000,${lat},${lon});
    );
    out center;`;

    fetch("https://overpass-api.de/api/interpreter", {
        method: "POST",
        body: "data=" + encodeURIComponent(q)
    })
    .then(r => r.json())
    .then(d => {
        markers.clearLayers();
        let say = 0;
        let html = "";

        d.elements.forEach(el => {
            const ad = el.tags?.name || "Ä°simsiz Cami/Mescit";
            const la = el.lat || el.center?.lat;
            const lo = el.lon || el.center?.lon;
            
            if(!la || !lo) return;
            say++;

            // Marker ekle
            L.marker([la, lo]).addTo(markers)
                .bindPopup(`<b>${ad}</b><br><a href="https://www.google.com/maps/dir/?api=1&destination=${la},${lo}" target="_blank">ğŸ“ Yol Tarifi Al</a>`);

            html += `<li><span>${ad}</span> <a href="https://www.google.com/maps/dir/?api=1&destination=${la},${lo}" target="_blank" class="yol-btn">GÄ°T</a></li>`;
        });

        document.getElementById("sonuclar").innerHTML = html || "<li>YakÄ±nda cami bulunamadÄ±.</li>";
        document.getElementById("sayac").innerText = say + " Cami";
        document.getElementById("durum").innerText = "BÃ¶lge GÃ¼ncel";
    })
    .catch(err => {
        document.getElementById("durum").innerText = "Hata oluÅŸtu!";
        console.error(err);
    });
}

// Harita her hareket ettiÄŸinde listeyi gÃ¼ncelle
map.on('moveend', () => {
    const c = map.getCenter();
    camileriYukle(c.lat, c.lng);
});
</script>

</body>
</html>
