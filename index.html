<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>TÃ¼rkiye Camii Rehberi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body {
    margin: 0;
    font-family: system-ui, -apple-system;
    background: #f6f7f8;
}

header {
    background: #fff;
    padding: 10px;
    border-bottom: 1px solid #e0e0e0;
}

.title {
    text-align: center;
    font-weight: 600;
    color: #1f7a3a;
    margin-bottom: 8px;
}

.filters {
    display: flex;
    gap: 8px;
}

select {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background: #fff;
}

#map {
    height: calc(100vh - 95px);
}

.btn {
    display: block;
    padding: 7px;
    margin-top: 6px;
    text-align: center;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
}

.osm { background:#2e7d32;color:#fff; }
.google { background:#fbbc04;color:#000; }
</style>
</head>

<body>

<header>
    <div class="title">ğŸ•Œ TÃ¼rkiye Camii Rehberi</div>
    <div class="filters">
        <select id="il">
            <option value="">Ä°l SeÃ§iniz</option>
            <option value="Konya">Konya</option>
            <option value="Ankara">Ankara</option>
            <option value="Ä°stanbul">Ä°stanbul</option>
            <option value="Ä°zmir">Ä°zmir</option>
            <option value="Bursa">Bursa</option>
        </select>

        <select id="ilce">
            <option value="">Ä°lÃ§e SeÃ§iniz</option>
        </select>
    </div>
</header>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
var map = L.map('map').setView([39,35], 6);
var markers = [];

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

// Ä°l - Ä°lÃ§e verisi (Ã¶rnek â€“ geniÅŸletilebilir)
var ilceler = {
    "Konya": ["SelÃ§uklu","Meram","Karatay"],
    "Ankara": ["Ã‡ankaya","KeÃ§iÃ¶ren","Yenimahalle"],
    "Ä°stanbul": ["Fatih","ÃœskÃ¼dar","Pendik"],
    "Ä°zmir": ["Konak","KarÅŸÄ±yaka","Bornova"],
    "Bursa": ["Osmangazi","NilÃ¼fer","YÄ±ldÄ±rÄ±m"]
};

document.getElementById("il").addEventListener("change", function(){
    var il = this.value;
    var ilceSelect = document.getElementById("ilce");
    ilceSelect.innerHTML = "<option value=''>Ä°lÃ§e SeÃ§iniz</option>";

    if(ilceler[il]){
        ilceler[il].forEach(i=>{
            ilceSelect.innerHTML += `<option value="${i}">${i}</option>`;
        });
    }
    loadCamiler(il, "");
});

document.getElementById("ilce").addEventListener("change", function(){
    loadCamiler(document.getElementById("il").value, this.value);
});

function clearMarkers(){
    markers.forEach(m => map.removeLayer(m));
    markers = [];
}

function loadCamiler(il, ilce){
    if(!il) return;
    clearMarkers();

    var areaQuery = `
    area["name"="${il}"]["admin_level"="4"]->.a;
    ${ilce ? 'area["name"="'+ilce+'"]["admin_level"="6"]->.b;' : ''}
    (
      node(area.${ilce ? 'b' : 'a'})["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."];
      way(area.${ilce ? 'b' : 'a'})["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."];
    );
    out center;
    `;

    fetch("https://overpass-api.de/api/interpreter", {
        method: "POST",
        body: `[out:json][timeout:40];${areaQuery}`
    })
    .then(r=>r.json())
    .then(data=>{
        if(data.elements.length > 0){
            map.setView([
                data.elements[0].lat || data.elements[0].center.lat,
                data.elements[0].lon || data.elements[0].center.lon
            ], 11);
        }

        data.elements.forEach(el=>{
            var lat = el.lat || el.center.lat;
            var lon = el.lon || el.center.lon;

            var osm = `https://www.openstreetmap.org/edit?editor=id#map=19/${lat}/${lon}`;
            var google = `https://www.google.com/maps/search/cami/@${lat},${lon},19z`;

            var marker = L.circleMarker([lat,lon],{
                radius:6,color:"#1f7a3a",fillOpacity:0.9
            }).addTo(map)
            .bindPopup(`
                <b>â— Ä°simsiz Cami</b><br>
                <a class="btn osm" href="${osm}" target="_blank">OSM'de Ä°sim Gir</a>
                <a class="btn google" href="${google}" target="_blank">Google'da Kontrol</a>
            `);

            markers.push(marker);
        });
    });
}
</script>

</body>
</html>