<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>TÃ¼rkiye Camii Rehberi | OSM Veri DÃ¼zenleme</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        :root {
            --primary: #14532d;
            --secondary: #16a34a;
            --bg: #f4f5f7;
            --text: #1f2937;
        }

        html, body { height: 100%; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; }

        header { background: #ffffff; padding: 15px; border-bottom: 3px solid var(--primary); box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; }
        header h1 { margin: 0; font-size: 20px; color: var(--primary); }
        header small { color: #6b7280; font-size: 13px; font-weight: 500; }

        .etiket { background: #ecfdf5; color: #065f46; text-align: center; font-size: 12px; padding: 8px; border-bottom: 1px solid #d1fae5; }

        .controls { padding: 15px; background: #ffffff; border-bottom: 1px solid #e5e7eb; display: flex; flex-direction: column; gap: 10px; }
        select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 15px; background-color: #fff; cursor: pointer; outline: none; }
        select:focus { border-color: var(--secondary); ring: 2px var(--secondary); }

        /* Dinamik SayaÃ§ TasarÄ±mÄ± */
        #sayac { 
            padding: 12px; 
            text-align: center; 
            font-size: 14px; 
            font-weight: 700; 
            background: #fff; 
            border-bottom: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .loading { color: #2563eb; background: #eff6ff !important; }
        .success { color: #16a34a; background: #f0fdf4 !important; }
        .empty { color: #92400e; background: #fffbeb !important; }
        .error { color: #dc2626; background: #fef2f2 !important; }

        #map { flex-grow: 1; width: 100%; z-index: 1; }

        /* Popup Stilleri */
        .leaflet-popup-content-wrapper { border-radius: 12px; padding: 5px; }
        .popup-container { min-width: 180px; text-align: center; }
        .popup-container b { display: block; margin-bottom: 10px; color: #b91c1c; font-size: 14px; }
        .btn { display: block; text-align: center; padding: 10px; margin-top: 6px; border-radius: 6px; text-decoration: none; font-weight: bold; font-size: 13px; transition: 0.2s; }
        .osm-btn { background: #166534; color: #ffffff; }
        .google-btn { background: #fde047; color: #000000; }
        .btn:hover { opacity: 0.8; transform: translateY(-1px); }
    </style>
</head>
<body>

<header>
    <h1>ğŸ•Œ TÃ¼rkiye Camii Rehberi</h1>
    <small>Ä°simsiz Camileri Belirleme ve OSM KatkÄ± Paneli</small>
</header>

<div class="etiket">
    â„¹ï¸ Bu harita OpenStreetMap verilerini iyileÅŸtirmek iÃ§in geliÅŸtirilmiÅŸtir.
</div>

<div class="controls">
    <select id="il">
        <option value="">LÃ¼tfen bir il seÃ§in...</option>
        <option>Adana</option><option>AdÄ±yaman</option><option>Afyonkarahisar</option><option>AÄŸrÄ±</option><option>Amasya</option><option>Ankara</option><option>Antalya</option><option>Artvin</option><option>AydÄ±n</option><option>BalÄ±kesir</option><option>Bilecik</option><option>BingÃ¶l</option><option>Bitlis</option><option>Bolu</option><option>Burdur</option><option>Bursa</option><option>Ã‡anakkale</option><option>Ã‡ankÄ±rÄ±</option><option>Ã‡orum</option><option>Denizli</option><option>DiyarbakÄ±r</option><option>Edirne</option><option>ElazÄ±ÄŸ</option><option>Erzincan</option><option>Erzurum</option><option>EskiÅŸehir</option><option>Gaziantep</option><option>Giresun</option><option>GÃ¼mÃ¼ÅŸhane</option><option>Hakkari</option><option>Hatay</option><option>Isparta</option><option>Mersin</option><option>Ä°stanbul</option><option>Ä°zmir</option><option>Kars</option><option>Kastamonu</option><option>Kayseri</option><option>KÄ±rklareli</option><option>KÄ±rÅŸehir</option><option>Kocaeli</option><option>Konya</option><option>KÃ¼tahya</option><option>Malatya</option><option>Manisa</option><option>KahramanmaraÅŸ</option><option>Mardin</option><option>MuÄŸla</option><option>MuÅŸ</option><option>NevÅŸehir</option><option>NiÄŸde</option><option>Ordu</option><option>Rize</option><option>Sakarya</option><option>Samsun</option><option>Siirt</option><option>Sinop</option><option>Sivas</option><option>TekirdaÄŸ</option><option>Tokat</option><option>Trabzon</option><option>Tunceli</option><option>ÅanlÄ±urfa</option><option>UÅŸak</option><option>Van</option><option>Yozgat</option><option>Zonguldak</option><option>Aksaray</option><option>Bayburt</option><option>Karaman</option><option>KÄ±rÄ±kkale</option><option>Batman</option><option>ÅÄ±rnak</option><option>BartÄ±n</option><option>Ardahan</option><option>IÄŸdÄ±r</option><option>Yalova</option><option>KarabÃ¼k</option><option>Kilis</option><option>Osmaniye</option><option>DÃ¼zce</option>
    </select>
</div>

<div id="sayac">Analiz iÃ§in bir ÅŸehir seÃ§meniz bekleniyor.</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Harita BaÅŸlangÄ±Ã§ (TÃ¼rkiye Merkezi)
    var map = L.map('map').setView([39.0, 35.0], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap Contributors'
    }).addTo(map);

    var layerGroup = L.layerGroup().addTo(map);

    document.getElementById("il").addEventListener("change", function () {
        var il = this.value;
        var sayac = document.getElementById("sayac");
        
        if (!il) {
            sayac.innerHTML = "Analiz iÃ§in bir ÅŸehir seÃ§meniz bekleniyor.";
            sayac.className = "";
            return;
        }

        // SayaÃ§: YÃ¼kleniyor Durumu
        layerGroup.clearLayers();
        sayac.innerHTML = `âŒ› ${il} verileri sorgulanÄ±yor, lÃ¼tfen bekleyin...`;
        sayac.className = "loading";

        // Overpass API Sorgusu
        var query = `
        [out:json][timeout:50];
        area["name"="${il}"]["admin_level"="4"]->.a;
        (
          node["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."](area.a);
          way["amenity"="place_of_worship"]["religion"="muslim"]["name"!~"."](area.a);
        );
        out center;`;

        fetch("https://overpass-api.de/api/interpreter", {
            method: "POST",
            body: query
        })
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            var adet = data.elements.length;
            var points = [];

            if (adet === 0) {
                sayac.innerHTML = `ğŸ‰ Harika! ${il} ilinde isimsiz cami bulunamadÄ±.`;
                sayac.className = "empty";
                return;
            }

            // SayaÃ§: BaÅŸarÄ±lÄ± Durumu
            sayac.innerHTML = `ğŸ“ ${il} ilinde <b>${adet}</b> adet isimsiz cami tespit edildi.`;
            sayac.className = "success";

            data.elements.forEach(el => {
                var lat = el.lat || (el.center ? el.center.lat : null);
                var lon = el.lon || (el.center ? el.center.lon : null);
                
                if (lat && lon) {
                    points.push([lat, lon]);

                    var osmEditUrl = `https://www.openstreetmap.org/edit?editor=id#map=19/${lat}/${lon}`;
                    var googleSearchUrl = `https://www.google.com/maps/search/${lat},${lon}`;

                    var popupHtml = `
                        <div class="popup-container">
                            <b>âš ï¸ Ä°simsiz KayÄ±t</b>
                            <a href="${osmEditUrl}" target="_blank" class="btn osm-btn">âœï¸ OSM'de Ä°smini Gir</a>
                            <a href="${googleSearchUrl}" target="_blank" class="btn google-btn">ğŸ” Google'da DoÄŸrula</a>
                        </div>
                    `;

                    L.circleMarker([lat, lon], {
                        radius: 7,
                        color: "#14532d",
                        fillColor: "#22c55e",
                        fillOpacity: 0.9,
                        weight: 2
                    })
                    .addTo(layerGroup)
                    .bindPopup(popupHtml);
                }
            });

            // HaritayÄ± verilere gÃ¶re otomatik odakla
            if (points.length > 0) {
                map.fitBounds(L.latLngBounds(points), { padding: [40, 40] });
            }
        })
        .catch(err => {
            console.error(err);
            sayac.innerHTML = "âŒ Veri alÄ±nÄ±rken bir hata oluÅŸtu. Overpass API yoÄŸun olabilir.";
            sayac.className = "error";
        });
    });
</script>

</body>
</html>
