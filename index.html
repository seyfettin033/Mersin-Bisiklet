<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>T√úRKƒ∞YE Camileri</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body { margin:0; font-family: Arial, sans-serif; background:#f4f4f4; }

/* √úST BANT */
header {
  display:flex;
  align-items:center;
  gap:15px;
  padding:10px 15px;
  background:#e30a17;
  color:white;
}

.flag {
  width:60px;
  height:40px;
  background:linear-gradient(
    90deg,
    #e30a17 0%,
    #ff4d4d 50%,
    #e30a17 100%
  );
  animation: wave 2s infinite linear;
  border-radius:4px;
}

@keyframes wave {
  0% { background-position:0% }
  100% { background-position:200% }
}

header h1 {
  font-size:22px;
  margin:0;
  font-weight:bold;
}

/* NAMAZ */
#namaz {
  background:white;
  padding:10px;
  text-align:center;
}

#namaz span {
  margin:0 6px;
  font-weight:bold;
}

/* AYET */
#ayet {
  background:#fff3cd;
  padding:12px;
  font-style:italic;
  text-align:center;
}

/* MAP */
#map { height:55vh; }

/* ALT PANEL */
#panel {
  padding:10px;
  background:white;
}

#sonuclar li {
  padding:6px 0;
  border-bottom:1px solid #ddd;
}
</style>
</head>

<body>

<header>
  <div class="flag"></div>
  <h1>T√úRKƒ∞YE Camileri</h1>
</header>

<div id="namaz">Namaz saatleri y√ºkleniyor‚Ä¶</div>
<div id="ayet">G√ºn√ºn ayeti y√ºkleniyor‚Ä¶</div>

<div id="map"></div>

<div id="panel">
  <b id="durum">Hazƒ±r</b> |
  <b id="sayac">0 Cami</b>
  <ul id="sonuclar"></ul>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const map = L.map('map').setView([39, 35], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
const markers = L.layerGroup().addTo(map);

/* KONUM */
navigator.geolocation.getCurrentPosition(pos => {
  const lat = pos.coords.latitude;
  const lon = pos.coords.longitude;

  map.setView([lat, lon], 14);
  L.marker([lat, lon]).addTo(map).bindPopup("Bulunduƒüunuz konum").openPopup();

  namazSaatleri(lat, lon);
  camileriYukle(lat, lon);
});

/* NAMAZ SAATLERƒ∞ */
function namazSaatleri(lat, lon) {
  fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=13`)
    .then(r => r.json())
    .then(d => {
      const t = d.data.timings;
      document.getElementById("namaz").innerHTML = `
        <span>ƒ∞msak ${t.Fajr}</span>
        <span>√ñƒüle ${t.Dhuhr}</span>
        <span>ƒ∞kindi ${t.Asr}</span>
        <span>Ak≈üam ${t.Maghrib}</span>
        <span>Yatsƒ± ${t.Isha}</span>
      `;
    });
}

/* G√úN√úN AYETƒ∞ */
fetch("https://api.alquran.cloud/v1/ayah/262/tr.diyanet")
.then(r=>r.json())
.then(d=>{
  document.getElementById("ayet").innerText =
   `"${d.data.text}"`;
});

/* CAMƒ∞LER */
function camileriYukle(lat, lon) {
  document.getElementById("durum").innerText = "Camiler y√ºkleniyor...";
  const q = `
[out:json][timeout:25];
(
 node["amenity"="place_of_worship"](around:3000,${lat},${lon});
 way["amenity"="place_of_worship"](around:3000,${lat},${lon});
);
out center;
`;

  fetch("https://overpass-api.de/api/interpreter", {
    method:"POST",
    body:"data="+encodeURIComponent(q)
  })
  .then(r=>r.json())
  .then(d=>{
    markers.clearLayers();
    let say = 0;
    let html = "";

    d.elements.forEach(el=>{
      const ad = el.tags?.name || "";
      const isim = ad.toLowerCase();

      if (
        isim.includes("kilise") || isim.includes("sinagog") ||
        isim.includes("church") || isim.includes("surp") ||
        isim.includes("aya ")
      ) return;

      if (!(isim.includes("cami") || isim.includes("mescit"))) return;

      const la = el.lat || el.center?.lat;
      const lo = el.lon || el.center?.lon;
      if(!la || !lo) return;

      say++;

      L.marker([la, lo]).addTo(markers)
        .bindPopup(`
          <b>${ad}</b><br>
          <a target="_blank"
          href="https://www.google.com/maps/dir/?api=1&destination=${la},${lo}">
          üìç Yol Tarifi
          </a>
        `);

      html += `<li>${ad}</li>`;
    });

    document.getElementById("sonuclar").innerHTML = html;
    document.getElementById("sayac").innerText = say + " Cami";
    document.getElementById("durum").innerText = "G√ºncel";
  });
}
</script>

</body>
</html>